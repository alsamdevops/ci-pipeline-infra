pipeline {
  agent any

  stages {
    stage('Terraform Init & Apply') {
      steps {
        sh '''
          cd terraform
          terraform init
          terraform apply -auto-approve
          terraform output ansible_inventory > ../inventory.ini
        '''
      }
    }

    stage('Run Ansible Playbook') {
      steps {
        sh '''
          cd ansible
          ansible-playbook site.yml
        '''
      }
    }
  }
}

